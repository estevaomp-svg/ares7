<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ares RPG - Evolu√ß√£o F√≠sica</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #3b82f6; --danger: #ef4444; --success: #22c55e; --bg: #0f172a; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: #f8fafc; padding: 15px; margin: 0; }
        .card { background: rgba(30, 41, 59, 0.9); padding: 20px; border-radius: 15px; border: 1px solid rgba(51, 65, 85, 0.5); margin-bottom: 15px; }
        .grid-fisico { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box { background: rgba(51, 65, 85, 0.6); padding: 10px; border-radius: 10px; text-align: center; border: 1px solid #475569; }
        input { width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: none; text-align: center; background: #1e293b; color: white; }
        button { cursor: pointer; padding: 10px; border: none; border-radius: 8px; color: white; font-weight: bold; width: 100%; background: var(--danger); }
        .btn-back { background: var(--primary); text-decoration: none; display: block; text-align: center; padding: 12px; border-radius: 8px; color: white; margin-bottom: 15px; font-weight: bold; }
    </style>
</head>
<body>
    <a href="index.html" class="btn-back">‚¨Ö VOLTAR AO PAINEL</a>

    <div class="card">
        <h3 style="text-align:center; color: var(--danger);">üèãÔ∏è SALA DE TREINAMENTO</h3>
        <p id="p-status" style="text-align:center; color: #94a3b8; font-size: 14px;">Carregando...</p>
        <div class="grid-fisico" id="g-exercicios"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBanevR51ejaTE0ccqlmlU6VRh7Qg4EETs",
            authDomain: "aresrpg-7daf4.firebaseapp.com",
            databaseURL: "https://aresrpg-7daf4-default-rtdb.firebaseio.com",
            projectId: "aresrpg-7daf4",
            storageBucket: "aresrpg-7daf4.firebasestorage.app",
            messagingSenderId: "153757603214",
            appId: "1:153757603214:web:fb572985353c8fad7f80df"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(), auth = firebase.auth();
        let jogador = "";

        const exArr = [
            {id:'supino', n:'üí™ Supino Reto/M√°q', m:'kg', c:'#3b82f6', d:20}, {id:'biceps_rosca', n:'üí™ B√≠ceps Rosca', m:'kg', c:'#3b82f6', d:15},
            {id:'triceps_pulley', n:'üí™ Tr√≠ceps Pulley', m:'kg', c:'#3b82f6', d:15}, {id:'elevacao_pelvica', n:'üçë Eleva√ß√£o P√©lvica', m:'kg', c:'#f59e0b', d:20},
            {id:'puxada', n:'üëê Puxada Aberta', m:'kg', c:'#3b82f6', d:20}, {id:'remada', n:'üö£ Remada', m:'kg', c:'#3b82f6', d:20}, 
            {id:'elevacao_halters', n:'ü¶ã Eleva√ß√£o Halters', m:'kg', c:'#3b82f6', d:4}, {id:'leg_press', n:'ü¶µ Leg Press 45', m:'kg', c:'#f59e0b', d:30}, 
            {id:'hack', n:'üçë Hack Machine', m:'kg', c:'#f59e0b', d:40}, {id:'extensora', n:'ü¶µ Extensora', m:'kg', c:'#f59e0b', d:20}, 
            {id:'panturrilha', n:'ü¶∂ Panturrilha', m:'kg', c:'#f59e0b', d:40}, {id:'flexao', n:'üßò Flex√£o Bra√ßo', m:'reps', c:'#10b981', d:10}, 
            {id:'barra', n:'üßó Barra Fixa', m:'reps', c:'#10b981', d:10}, {id:'agachamentoLivre', n:'ü§∏ Agach. Livre', m:'reps', c:'#10b981', d:10}, 
            {id:'stamina', n:'Ë∑ë Cardio/Dan√ßa', m:'min', c:'#ec4899', d:10}
        ];

        auth.onAuthStateChanged(u => {
            if(u) {
                jogador = u.email.split('@')[0].replace(/[.#$[\]]/g, "_");
                db.ref('rpg_data/' + jogador).on('value', s => { 
                    document.getElementById('p-status').innerText = "Atleta: " + (s.val().nick || jogador);
                    render(s.val() || {}); 
                });
            } else { document.getElementById('p-status').innerText = "Fa√ßa login no site principal."; }
        });

        function render(p) {
            const g = document.getElementById('g-exercicios');
            g.innerHTML = exArr.map(ex => {
                const r = (p.records && p.records[ex.id]) !== undefined ? p.records[ex.id] : ex.d;
                return `<div class="stat-box" style="border-top: 3px solid ${ex.c};">
                    <b style="color:${ex.c}; font-size:11px;">${ex.n}</b><br><span style="font-size:10px;">Rec: ${r}${ex.m}</span>
                    <input type="number" id="in-${ex.id}" placeholder="+"><button style="background:${ex.c};" onclick="up('${ex.id}','${ex.m}',${r})">UP</button>
                </div>`;
            }).join('');
        }

        async function up(id, m, r) {
            const v = parseInt(document.getElementById('in-' + id).value);
            if (!v || v <= r) return alert("Supera o recorde!");
            
            const snap = await db.ref('rpg_data/' + jogador).get();
            const p = snap.val();
            const agora = Date.now(), hist = p.evolucao_diaria || {}, dEx = hist[id] || { totalSubido: 0, ultimaData: 0 };
            const horas = (agora - dEx.ultimaData) / (1000 * 60 * 60);
            let jaSubiu = (horas < 20) ? dEx.totalSubido : 0;
            const aumento = v - r;

            // TRAVA DE +10 KG OU +10 REPS
            if ((jaSubiu + aumento) > 10) { 
                alert(`Limite di√°rio de +10 excedido! Voc√™ j√° subiu ${jaSubiu} hoje.`); 
                return; 
            }

            let mult = (id === 'elevacao_halters') ? 500 : 100, ganho = (m === 'kg') ? aumento * mult : aumento * 45;
            const novosRecs = { ... (p.records || {}) }; novosRecs[id] = v;
            const novoHist = { ...hist }; novoHist[id] = { totalSubido: jaSubiu + aumento, ultimaData: agora };

            await db.ref('rpg_data/' + jogador).update({
                xp: (p.xp || 0) + ganho, coins: (p.coins || 0) + ganho,
                records: novosRecs, evolucao_diaria: novoHist
            });
            alert(`UP! +${ganho} XP`);
        }
    </script>
</body>
</html>
