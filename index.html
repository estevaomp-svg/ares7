<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ares RPG - Oficial</title>
    
    <meta property="og:title" content="Ares RPG - Oficial">
    <meta property="og:description" content="Evolua seu personagem na vida real! Treine, estude e conquiste recompensas.">
    <meta property="og:image" content="https://i.ibb.co/X3vDgg/image.png">
    <meta property="og:type" content="website">

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root { --primary: #3b82f6; --danger: #ef4444; --success: #22c55e; --warning: #fbbf24; --bg: #0f172a; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(rgba(15, 23, 42, 0.8), rgba(15, 23, 42, 0.9)), 
                        url('https://images.unsplash.com/photo-1543007630-9710e4050a19?q=80&w=2000&auto=format&fit=crop'); 
            background-size: cover; background-attachment: fixed;
            color: #f8fafc; margin: 0; padding: 15px; padding-bottom: 80px;
        }
        .card { background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(10px); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid rgba(51, 65, 85, 0.5); }
        .player-img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #3b82f6; object-fit: cover; background: #1e293b; display: inline-block; vertical-align: middle; }
        .lvl-badge { background: #fbbf24; color: #1e293b; padding: 5px 15px; border-radius: 20px; font-weight: bold; display: inline-block; margin: 10px 0; }
        .progress-bar { background: #475569; border-radius: 10px; height: 12px; width: 100%; overflow: hidden; margin: 10px 0; }
        .progress-fill { background: linear-gradient(90deg, #3b82f6, #60a5fa); height: 100%; width: 0%; transition: width 0.5s ease; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; background: white; color: black; }
        button { cursor: pointer; padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; transition: 0.3s; }
        .btn-check { background: #22c55e; padding: 8px 15px; }
        .btn-del { background: #ef4444; padding: 8px 12px; margin-left: 5px; }
        .btn-physic { background: #ef4444; margin-top: 5px; width: 100%; }
        
        /* --- ARENA ESTILO LEGEND ONLINE (2.5D) --- */
        #arena-duelo { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 2000; display: none; 
            flex-direction: column; align-items: center; justify-content: center;
        }
        .battle-stage { 
            width: 95%; max-width: 600px; height: 350px; 
            background: url('https://i.ibb.co/L8N6M8S/battleground.jpg') center/cover;
            position: relative; border: 4px solid #fbbf24; border-radius: 10px; overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,1);
        }
        .char-container { position: absolute; text-align: center; width: 100px; transition: transform 0.1s; }
        #char-enemy { top: 20%; right: 15%; }
        #char-player { bottom: 15%; left: 15%; }
        .battle-img { width: 80px; height: 80px; border-radius: 10px; border: 3px solid white; object-fit: cover; background: #1e293b; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        
        /* ANIMA√á√ïES DE IMPACTO */
        @keyframes dash-player { 0% { transform: translate(0, 0); } 50% { transform: translate(200px, -100px) scale(1.3); } 100% { transform: translate(0, 0); } }
        @keyframes dash-enemy { 0% { transform: translate(0, 0); } 50% { transform: translate(-200px, 100px) scale(1.3); } 100% { transform: translate(0, 0); } }
        @keyframes shake { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(6px, 6px); } 50% { transform: translate(-6px, -6px); } 75% { transform: translate(6px, -6px); } }
        @keyframes hit-flash { 0% { filter: brightness(1); } 50% { filter: brightness(3) sepia(1); transform: scale(0.9); } 100% { filter: brightness(1); } }
        
        .atk-p { animation: dash-player 0.5s ease-in-out; }
        .atk-e { animation: dash-enemy 0.5s ease-in-out; }
        .hit { animation: hit-flash 0.3s; }
        .shaking { animation: shake 0.2s; }

        #battle-log { background: rgba(0,0,0,0.8); color: #fbbf24; width: 95%; max-width: 600px; height: 60px; padding: 10px; font-size: 14px; text-align: center; border-top: 2px solid gold; margin-top: -5px; }
        .hp-bar { width: 100%; height: 8px; background: #333; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .hp-fill { height: 100%; background: #22c55e; width: 100%; transition: width 0.3s; }

        /* JOGO DA VELHA E OUTROS */
        #arena-velha { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.98); z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .velha-grid { display: grid; grid-template-columns: repeat(3, 80px); gap: 10px; background: #334155; padding: 10px; border-radius: 10px; }
        .velha-cell { width: 80px; height: 80px; background: #1e293b; display: flex; align-items: center; justify-content: center; font-size: 30px; border-radius: 8px; cursor: pointer; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #1e293b; display: flex; justify-content: space-around; padding: 10px 0; border-top: 2px solid #3b82f6; z-index: 1000; }
        .nav-item { color: #94a3b8; font-size: 12px; text-align: center; cursor: pointer; }
        .active { color: #3b82f6; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="arena-duelo">
        <h2 style="color:gold">DUELO DE HONRA</h2>
        <div class="battle-stage" id="stage">
            <div id="char-enemy" class="char-container">
                <div style="color:red; font-size:12px; font-weight:bold" id="name-e">Inimigo</div>
                <img id="img-e" class="battle-img" src="">
                <div class="hp-bar"><div id="hp-e-fill" class="hp-fill"></div></div>
            </div>
            <div id="char-player" class="char-container">
                <div class="hp-bar"><div id="hp-p-fill" class="hp-fill"></div></div>
                <img id="img-p" class="battle-img" src="">
                <div style="color:cyan; font-size:12px; font-weight:bold" id="name-p">Voc√™</div>
            </div>
        </div>
        <div id="battle-log">Aguardando...</div>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button id="btn-atk" style="background:red; padding: 15px 40px" onclick="executarAtaque()">ATACAR</button>
            <button id="btn-sair-duelo" class="hidden" style="background:blue; padding: 15px 40px" onclick="fecharArena()">SAIR</button>
        </div>
    </div>

    <div id="arena-velha">
        <h2 id="velha-info" style="color: var(--warning);">Sua vez!</h2>
        <div class="velha-grid">
            <div class="velha-cell" onclick="cliqueVelha(0)"></div><div class="velha-cell" onclick="cliqueVelha(1)"></div><div class="velha-cell" onclick="cliqueVelha(2)"></div>
            <div class="velha-cell" onclick="cliqueVelha(3)"></div><div class="velha-cell" onclick="cliqueVelha(4)"></div><div class="velha-cell" onclick="cliqueVelha(5)"></div>
            <div class="velha-cell" onclick="cliqueVelha(6)"></div><div class="velha-cell" onclick="cliqueVelha(7)"></div><div class="velha-cell" onclick="cliqueVelha(8)"></div>
        </div>
        <button onclick="sairVelha()" style="margin-top:20px; background:var(--danger)">Sair</button>
    </div>

    <div id="auth-screen" class="card" style="max-width:400px; margin: 20px auto; text-align:center;">
        <div id="login-area">
            <h2>Ares RPG - Entrar</h2>
            <input type="email" id="login-email" placeholder="Email">
            <input type="password" id="login-pass" placeholder="Senha">
            <button style="background:var(--primary); width:100%" onclick="fazerLogin()">Entrar</button>
            <p onclick="document.getElementById('login-area').className='hidden'; document.getElementById('reg-area').className=''">Criar Conta</p>
        </div>
        <div id="reg-area" class="hidden">
            <h2>Novo Guerreiro</h2>
            <input type="text" id="reg-nick" placeholder="Nick">
            <input type="email" id="reg-email" placeholder="Email">
            <input type="password" id="reg-pass" placeholder="Senha">
            <button style="background:var(--success); width:100%" onclick="fazerCadastro()">Come√ßar</button>
        </div>
    </div>

    <div id="game-content" class="hidden">
        <div id="tab-home">
            <div class="card">
                <div style="display:flex; align-items:center; gap:10px">
                    <img id="p-img" class="player-img" src="">
                    <b><span id="player-name">---</span></b>
                </div>
                <div class="lvl-badge">LVL <span id="lvl">1</span></div>
                <div class="progress-bar"><div id="progress" class="progress-fill"></div></div>
                <p>üí∞ Moedas: <span id="coins">0</span> | XP: <span id="xp">0</span></p>
            </div>

            <div class="card">
                <h3>‚öîÔ∏è Ranking & Duelos</h3>
                <table width="100%" id="ranking-body"></table>
            </div>

            <div class="card">
                <h3>üî• Treino F√≠sico (Limite +10/dia)</h3>
                <div id="grid-fisico" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
            </div>

            <div class="card">
                <h3>‚ö° Miss√µes Di√°rias</h3>
                <div id="lista-obrigatoria"></div>
            </div>
        </div>

        <div id="tab-profile" class="hidden">
            <div class="card" style="text-align:center">
                <h2>Perfil</h2>
                <img id="p-img-large" style="width:100px; height:100px; border-radius:50%; margin-bottom:10px;" src="">
                <input type="text" id="edit-nick" placeholder="Nick">
                <input type="text" id="edit-photo" placeholder="Link da Foto">
                <button style="background:var(--success); width:100%" onclick="salvarPerfil()">Salvar</button>
                <button style="background:var(--danger); width:100%; margin-top:10px" onclick="auth.signOut()">Sair</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" id="nav-home" onclick="mudarAba('home')">üè† In√≠cio</div>
            <div class="nav-item" id="nav-profile" onclick="mudarAba('profile')">üë§ Perfil</div>
        </nav>
    </div>

    <script>
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBanevR51ejaTE0ccqlmlU6VRh7Qg4EETs",
            authDomain: "aresrpg-7daf4.firebaseapp.com",
            databaseURL: "https://aresrpg-7daf4-default-rtdb.firebaseio.com",
            projectId: "aresrpg-7daf4",
            storageBucket: "aresrpg-7daf4.firebasestorage.app",
            messagingSenderId: "153757603214",
            appId: "1:153757603214:web:fb572985353c8fad7f80df"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(), auth = firebase.auth();
        let jogadorAtual = "", dadosGerais = {}, battleData = { ativa: false };

        // --- DUELO ANIMADO ---
        function iniciarDuelo(idI, nickI) {
            const p = dadosGerais[jogadorAtual], e = dadosGerais[idI];
            battleData = {
                p: { hp: 1000, max: 1000, atk: 120, img: p.photo || 'https://via.placeholder.com/80', nick: p.nick },
                e: { hp: 1000, max: 1000, atk: 110, img: e.photo || 'https://via.placeholder.com/80', nick: nickI },
                ativa: true
            };
            document.getElementById('img-p').src = battleData.p.img;
            document.getElementById('img-e').src = battleData.e.img;
            document.getElementById('name-p').innerText = battleData.p.nick;
            document.getElementById('name-e').innerText = battleData.e.nick;
            document.getElementById('hp-p-fill').style.width = "100%";
            document.getElementById('hp-e-fill').style.width = "100%";
            document.getElementById('arena-duelo').style.display = 'flex';
            document.getElementById('btn-atk').classList.remove('hidden');
            document.getElementById('btn-sair-duelo').classList.add('hidden');
            document.getElementById('battle-log').innerText = "Que comece a luta!";
        }

        function executarAtaque() {
            if(!battleData.ativa) return;
            const charP = document.getElementById('char-player'), charE = document.getElementById('char-enemy'), stage = document.getElementById('stage');
            
            charP.classList.add('atk-p');
            setTimeout(() => {
                let d = battleData.p.atk + Math.floor(Math.random()*40);
                battleData.e.hp -= d;
                charE.classList.add('hit');
                stage.classList.add('shaking');
                document.getElementById('hp-e-fill').style.width = (battleData.e.hp/battleData.e.max*100) + "%";
                document.getElementById('battle-log').innerText = `Dano causado: ${d}!`;

                setTimeout(() => {
                    charP.classList.remove('atk-p'); charE.classList.remove('hit'); stage.classList.remove('shaking');
                    if(battleData.e.hp <= 0) finalizar(true); else setTimeout(turnoInimigo, 600);
                }, 400);
            }, 250);
        }

        function turnoInimigo() {
            if(!battleData.ativa) return;
            const charP = document.getElementById('char-player'), charE = document.getElementById('char-enemy'), stage = document.getElementById('stage');
            
            charE.classList.add('atk-e');
            setTimeout(() => {
                let d = battleData.e.atk + Math.floor(Math.random()*40);
                battleData.p.hp -= d;
                charP.classList.add('hit');
                stage.classList.add('shaking');
                document.getElementById('hp-p-fill').style.width = (battleData.p.hp/battleData.p.max*100) + "%";
                document.getElementById('battle-log').innerText = `O inimigo atacou: -${d} HP!`;

                setTimeout(() => {
                    charE.classList.remove('atk-e'); charP.classList.remove('hit'); stage.classList.remove('shaking');
                    if(battleData.p.hp <= 0) finalizar(false);
                }, 400);
            }, 250);
        }

        function finalizar(v) {
            battleData.ativa = false;
            document.getElementById('battle-log').innerText = v ? "üèÜ VIT√ìRIA! +5 XP" : "üíÄ DERROTA...";
            document.getElementById('btn-atk').classList.add('hidden');
            document.getElementById('btn-sair-duelo').classList.remove('hidden');
            if(v) db.ref('rpg_data/'+jogadorAtual).update({ xp: (dadosGerais[jogadorAtual].xp||0)+5 });
        }
        function fecharArena() { document.getElementById('arena-duelo').style.display = 'none'; }

        // --- SISTEMA CORE ---
        auth.onAuthStateChanged(u => {
            if(u) {
                jogadorAtual = u.email.split('@')[0].replace(/[.#$[\]]/g, "_");
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('game-content').classList.remove('hidden');
                db.ref('rpg_data').on('value', s => { 
                    dadosGerais = s.val() || {}; 
                    const p = dadosGerais[jogadorAtual];
                    document.getElementById('player-name').innerText = p.nick || jogadorAtual;
                    document.getElementById('xp').innerText = p.xp || 0;
                    document.getElementById('coins').innerText = p.coins || 0;
                    document.getElementById('lvl').innerText = Math.floor((p.xp || 0)/1000)+1;
                    document.getElementById('progress').style.width = ((p.xp || 0)%1000)/10 + "%";
                    document.getElementById('p-img').src = document.getElementById('p-img-large').src = p.photo || 'https://via.placeholder.com/100';
                    renderTudo();
                });
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('game-content').classList.add('hidden');
            }
        });

        function renderTudo() {
            // Ranking
            const tb = document.getElementById('ranking-body'); tb.innerHTML = "";
            Object.keys(dadosGerais).forEach(id => {
                const p = dadosGerais[id];
                tb.innerHTML += `<tr><td>${p.nick || id}</td><td>Lv.${Math.floor((p.xp||0)/1000)+1}</td>
                <td>${id!==jogadorAtual ? `<button style="background:red; padding:5px" onclick="iniciarDuelo('${id}','${p.nick}')">LUTAR</button>` : ''}</td></tr>`;
            });

            // Treino F√≠sico
            const g = document.getElementById('grid-fisico'); g.innerHTML = "";
            const exercicios = [{id:'supino', n:'Supino'}, {id:'biceps_rosca', n:'B√≠ceps'}, {id:'triceps_pulley', n:'Tr√≠ceps'}, {id:'elevacao_pelvica', n:'Elev. P√©lvica'}];
            exercicios.forEach(ex => {
                g.innerHTML += `<div class="card" style="margin:0; text-align:center; padding:10px">
                    <small>${ex.n}</small><br>
                    <input type="number" id="in-${ex.id}" placeholder="kg" style="width:50px; padding:5px; margin:5px 0">
                    <button class="btn-physic" onclick="upFisico('${ex.id}')">UP</button>
                </div>`;
            });

            // Miss√µes
            const mO = document.getElementById('lista-obrigatoria'); mO.innerHTML = "";
            const hoje = new Date().toLocaleDateString().replace(/\//g, '-');
            ["Treino", "Trabalho", "Estudo"].forEach(n => {
                const id = `d-${n}-${hoje}`, p = dadosGerais[jogadorAtual], feito = (p.missoes||[]).some(m => m.id === id);
                mO.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px"><span>${n}</span>
                <button class="${feito?'hidden':'btn-check'}" onclick="fazerMissao('${id}')">‚úî</button>${feito?'‚úÖ':''}</div>`;
            });
        }

        function upFisico(id) {
            const v = parseInt(document.getElementById('in-'+id).value), p = dadosGerais[jogadorAtual], hoje = new Date().toLocaleDateString();
            if(!v) return;
            const hist = p.evolucao_diaria || {};
            const jaFez = (hist[id]?.data === hoje) ? hist[id].qtd : 0;
            if(jaFez >= 10) return alert("Limite de +10 atingido!");
            db.ref('rpg_data/'+jogadorAtual).update({ xp: (p.xp||0)+100, coins: (p.coins||0)+100, [`evolucao_diaria/${id}`]: { data: hoje, qtd: jaFez + 1 } });
        }

        function fazerMissao(id) {
            const p = dadosGerais[jogadorAtual], ms = p.missoes || [];
            ms.push({id, concluida: true});
            db.ref('rpg_data/'+jogadorAtual).update({ xp: (p.xp||0)+10, coins: (p.coins||0)+10, missoes: ms });
        }

        function mudarAba(a) {
            document.getElementById('tab-home').className = a==='home'?'':'hidden';
            document.getElementById('tab-profile').className = a==='profile'?'':'hidden';
            document.getElementById('nav-home').className = a==='home'?'nav-item active':'nav-item';
            document.getElementById('nav-profile').className = a==='profile'?'nav-item active':'nav-item';
        }

        function fazerLogin() { auth.signInWithEmailAndPassword(document.getElementById('login-email').value, document.getElementById('login-pass').value); }
        function fazerCadastro() {
            const n = document.getElementById('reg-nick').value, e = document.getElementById('reg-email').value, p = document.getElementById('reg-pass').value;
            auth.createUserWithEmailAndPassword(e, p).then(() => {
                db.ref('rpg_data/'+e.split('@')[0].replace(/[.#$[\]]/g, "_")).set({ nick: n, xp: 0, coins: 0 });
            });
        }
        function salvarPerfil() {
            db.ref('rpg_data/'+jogadorAtual).update({ nick: document.getElementById('edit-nick').value, photo: document.getElementById('edit-photo').value });
            alert("Salvo!");
        }
    </script>
</body>
</html>
